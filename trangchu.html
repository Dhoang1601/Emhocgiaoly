<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Chủ Giáo Lý</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        /* CSS riêng cho trangchu.html */
        .main-container {
            flex-grow: 1; /* Cho phép container giãn nở để chiếm hết không gian */
            display: flex;
            flex-direction: column;
            align-items: center; /* Căn giữa nội dung */
            padding: 20px;
            max-width: 800px; /* Giới hạn chiều rộng cho con đường */
            margin: 0 auto; /* Căn giữa container */
            background: none; /* Bỏ nền trắng mặc định để nền body hiển thị */
            box-shadow: none; /* Bỏ đổ bóng mặc định */
        }

        h1 {
            color: #333;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 30px;
            text-align: center;
        }

        .info-bar {
            background-color: #e8f5e9;
            color: #388e3c;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 600px; /* Giới hạn chiều rộng của info-bar */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .info-bar button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }
        .info-bar button:hover {
            background-color: #388e3c;
        }

        /* Nút quay lại và đặt lại (nút chung cho toàn trang) */
        .fixed-action-buttons {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        .fixed-action-buttons .btn {
            padding: 10px 20px;
            font-size: 16px;
        }
        .fixed-action-buttons .btn.secondary {
            background-color: #6c757d; /* Màu xám */
        }
        .fixed-action-buttons .btn.secondary:hover {
            background-color: #5a6268;
        }
        /* Ẩn nút "BẮT ĐẦU BÀI HỌC" của Duolingo nếu không cần */
        #startLessonBtn {
            display: none;
        }
        /* Điều chỉnh cho navbar trên trang này */
        .navbar {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08); /* Đổ bóng như trên các trang khác */
        }
        
        /* Đảm bảo chiều cao tối thiểu cho body để footer không bị chồng lên */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="index.html" class="logo">GiaoLy</a>
    </nav>

    <div class="main-container">
        <h1 id="pageTitle">Các Bài Học</h1>

        <div class="info-bar">
            <span id="currentSelection"></span>
            <button id="changeSelectionBtn">Đổi ngành/lớp</button>
        </div>

        <div class="learning-path" id="lessonLearningPath">
            </div>

        <button id="startLessonBtn" style="display: none;"></button>
    </div>

    <div class="fixed-action-buttons">
        <a href="index.html" class="btn secondary">Quay về trang chào mừng</a>
        <button class="btn secondary" id="resetSelectionBtn">Đặt lại lựa chọn</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const pageTitle = document.getElementById('pageTitle');
            const currentSelectionSpan = document.getElementById('currentSelection');
            const changeSelectionBtn = document.getElementById('changeSelectionBtn');
            const lessonLearningPath = document.getElementById('lessonLearningPath'); // Đổi id để phù hợp với learning path
            const resetSelectionBtn = document.getElementById('resetSelectionBtn');
            const startLessonBtn = document.getElementById('startLessonBtn'); // Nút bắt đầu bài học (có thể ẩn hoặc dùng lại)

            const savedPart = localStorage.getItem('selectedPart');
            const savedClass = localStorage.getItem('selectedClass');

            // Định nghĩa dữ liệu bài học với trạng thái giả định (ví dụ: 'completed', 'current', 'locked')
            const lessonData = {
                'xung-toi': {
                    name: 'Xưng Tội',
                    lessons: [ // Đổi sang format 'lessons' để đồng bộ với hoc.html
                        { id: 'xt1', title: 'Bài 1: Thiên Chúa Là Ai?', desc: 'Tìm hiểu về Thiên Chúa, Đấng tạo hóa muôn vật.', status: 'current' },
                        { id: 'xt2', title: 'Bài 2: Tội Là Gì?', desc: 'Hiểu về bản chất của tội lỗi và hậu quả.', status: 'locked' },
                        { id: 'xt3', title: 'Bài 3: Bí Tích Giải Tội', desc: 'Ý nghĩa và cách lãnh nhận Bí Tích Giải Tội.', status: 'locked' },
                        { id: 'xt4', title: 'Bài 4: Lương Tâm Và Tự Do', desc: 'Phân biệt thiện ác và ý nghĩa của tự do.', status: 'locked' },
                        { id: 'xt5', title: 'Bài 5: Các Điều Răn Chúa', desc: 'Nghiên cứu sâu hơn về Mười Điều Răn.', status: 'locked' },
                        { id: 'xt6', title: 'Bài 6: Ăn Năn Sám Hối', desc: 'Tầm quan trọng của lòng ăn năn và việc sám hối.', status: 'locked' },
                        { id: 'xt7', title: 'Bài 7: Examination of Conscience', desc: 'Cách xét mình trước khi xưng tội.', status: 'locked' },
                        { id: 'xt8', title: 'Bài 8: The Rite of Confession', desc: 'Quy trình và nghi thức Bí Tích Giải Tội.', status: 'locked' },
                        { id: 'xt9', title: 'Bài 9: Living a Renewed Life', desc: 'Sống một đời sống mới sau Giải Tội.', status: 'locked' }
                    ]
                },
                'them-suc': {
                    name: 'Thêm Sức',
                    lessons: [
                        { id: 'ts1', title: 'Bài 1: Chúa Thánh Thần', desc: 'Tìm hiểu về Ngôi Ba Thiên Chúa.', status: 'completed' },
                        { id: 'ts2', title: 'Bài 2: Bảy Ơn Chúa Thánh Thần', desc: 'Khám phá các ơn đặc biệt Chúa ban.', status: 'current' },
                        { id: 'ts3', title: 'Bài 3: Biểu Tượng Chúa Thánh Thần', desc: 'Các biểu tượng của Chúa Thánh Thần.', status: 'locked' },
                        { id: 'ts4', title: 'Bài 4: Sứ Vụ Của Kitô Hữu', desc: 'Vai trò của người Kitô hữu trong thế giới.', status: 'locked' },
                        { id: 'ts5', title: 'Bài 5: Bí Tích Thêm Sức', desc: 'Ý nghĩa và nghi thức Bí Tích Thêm Sức.', status: 'locked' },
                        { id: 'ts6', title: 'Bài 6: Sống Với Ơn Thánh Thần', desc: 'Cách sống và phát triển Ơn Chúa Thánh Thần.', status: 'locked' },
                        { id: 'ts7', title: 'Bài 7: Prophets and Mission', desc: 'Vai trò của các tiên tri và sứ mệnh của Kitô hữu.', status: 'locked' },
                        { id: 'ts8', title: 'Bài 8: The Fruits of the Holy Spirit', desc: 'Những hoa trái của Chúa Thánh Thần.', status: 'locked' },
                        { id: 'ts9', title: 'Bài 9: Serving the Community', desc: 'Phục vụ cộng đồng và truyền giáo.', status: 'locked' }
                    ]
                },
                'song-dao': {
                    name: 'Sống Đạo',
                    lessons: [
                        { id: 'sd1', title: 'Bài 1: Sống Đức Tin', desc: 'Đức tin là gì và làm sao để sống Đức Tin.', status: 'current' },
                        { id: 'sd2', title: 'Bài 2: Sống Đức Cậy', desc: 'Hy vọng vào Chúa và cuộc sống vĩnh cửu.', status: 'locked' },
                        { id: 'sd3', title: 'Bài 3: Sống Đức Mến', desc: 'Tình yêu đối với Thiên Chúa và tha nhân.', status: 'locked' },
                        { id: 'sd4', title: 'Bài 4: Cầu Nguyện', desc: 'Các hình thức và tầm quan trọng của cầu nguyện.', status: 'locked' },
                        { id: 'sd5', title: 'Bài 5: Các Bí Tích', desc: 'Tìm hiểu về các Bí Tích trong Giáo Hội.', status: 'locked' },
                        { id: 'sd6', title: 'Bài 6: Phụng Vụ', desc: 'Ý nghĩa và vai trò của Phụng Vụ.', status: 'locked' },
                        { id: 'sd7', title: 'Bài 7: Social Justice', desc: 'Công bằng xã hội và giáo huấn xã hội của Giáo Hội.', status: 'locked' },
                        { id: 'sd8', title: 'Bài 8: Stewardship', desc: 'Trách nhiệm quản lý các ơn Chúa ban.', status: 'locked' },
                        { id: 'sd9', title: 'Bài 9: Evangelization in Daily Life', desc: 'Loan báo Tin Mừng trong đời sống thường ngày.', status: 'locked' }
                    ]
                }
            };
            
            let activePopup = null; // Biến để theo dõi pop-up đang mở

            // Hàm để đóng pop-up đang mở
            function closeActivePopup() {
                if (activePopup) {
                    activePopup.classList.remove('show');
                    activePopup.parentNode.classList.remove('has-popup'); // Xóa class kích hoạt popup trên wrapper
                    activePopup = null;
                }
            }

            // Lắng nghe sự kiện click trên toàn bộ body để đóng pop-up khi click ra ngoài
            document.body.addEventListener('click', (event) => {
                if (activePopup && !activePopup.contains(event.target) && !event.target.closest('.lesson-node')) {
                    closeActivePopup();
                }
            });

            // Hàm render con đường học tập
            function renderLearningPath(partKey, classNum) {
                const partInfo = lessonData[partKey]; // Lấy thông tin part từ lessonData
                if (!partInfo) {
                    pageTitle.textContent = "Không tìm thấy Phần Học";
                    lessonLearningPath.innerHTML = "<p>Phần học bạn chọn không hợp lệ.</p>";
                    return;
                }

                // Tiêu đề trang sẽ là tên Phần Học và số Lớp (ví dụ: "Xưng Tội - Lớp 3")
                pageTitle.textContent = `${partInfo.name} Lớp ${classNum}`;
                currentSelectionSpan.textContent = `Bạn đang học: ${partInfo.name} Lớp ${classNum}`;
                lessonLearningPath.innerHTML = ''; // Xóa nội dung cũ

                const lessonsToDisplay = partInfo.lessons;

                lessonsToDisplay.forEach((lesson, index) => {
                    const lessonNodeWrapper = document.createElement('div');
                    lessonNodeWrapper.classList.add('lesson-node-wrapper');

                    const lessonNode = document.createElement('div');
                    lessonNode.classList.add('lesson-node');
                    lessonNode.dataset.lessonId = lesson.id; // Lưu ID bài học
                    lessonNode.dataset.lessonStatus = lesson.status; // Lưu trạng thái

                    // Thêm class cho trạng thái
                    if (lesson.status === 'current') {
                        lessonNode.classList.add('current');
                    } else if (lesson.status === 'completed') {
                        lessonNode.classList.add('completed');
                    } else if (lesson.status === 'locked') {
                        lessonNode.classList.add('locked');
                    }

                    const nodeNumber = document.createElement('div');
                    nodeNumber.classList.add('lesson-node-number');
                    nodeNumber.textContent = index + 1; // Số thứ tự bài học

                    const nodeText = document.createElement('div');
                    nodeText.classList.add('lesson-node-text');
                    // Hiển thị phần tên bài học trước dấu hai chấm, hoặc toàn bộ nếu không có
                    nodeText.textContent = lesson.title.split(':')[0].trim();

                    lessonNode.appendChild(nodeNumber);
                    lessonNode.appendChild(nodeText);
                    lessonNodeWrapper.appendChild(lessonNode);
                    
                    // Tạo pop-up cho mỗi node
                    const popup = document.createElement('div');
                    popup.classList.add('lesson-info-popup');
                    popup.innerHTML = `
                        <h3>${lesson.title}</h3>
                        <p>${lesson.desc}</p>
                        <button class="start-lesson-btn-popup">BẮT ĐẦU</button>
                    `;
                    lessonNodeWrapper.appendChild(popup);

                    lessonLearningPath.appendChild(lessonNodeWrapper);

                    // Xử lý sự kiện click cho từng node bài học
                    lessonNode.addEventListener('click', (event) => {
                        event.stopPropagation(); // Ngăn chặn sự kiện click lan ra body

                        closeActivePopup(); // Đóng pop-up đang mở nếu có

                        if (lesson.status === 'locked') {
                            alert('Bài học này đang bị khóa. Vui lòng hoàn thành các bài trước.');
                            return;
                        }

                        // Hiển thị pop-up cho node này
                        popup.classList.add('show');
                        lessonNodeWrapper.classList.add('has-popup'); // Thêm class vào wrapper để định vị popup
                        activePopup = popup; // Đặt pop-up này là pop-up đang hoạt động

                        // Đăng ký sự kiện click cho nút "BẮT ĐẦU" trong pop-up
                        const startBtnPopup = popup.querySelector('.start-lesson-btn-popup');
                        startBtnPopup.onclick = () => {
                            localStorage.setItem('currentLessonId', lesson.id);
                            window.location.href = `lesson-detail.html?part=${partKey}&class=${classNum}&lesson=${lesson.id}`;
                        };
                    });
                });

                // Tự động cuộn đến bài đang học nếu có
                const currentLessonNode = document.querySelector('.lesson-node.current');
                if (currentLessonNode) {
                    currentLessonNode.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }


            if (savedPart && savedClass) {
                renderLearningPath(savedPart, savedClass);
            } else {
                pageTitle.textContent = "Chào mừng!";
                currentSelectionSpan.textContent = "Bạn chưa chọn ngành và lớp học.";
                lessonLearningPath.innerHTML = `
                    <p>Vui lòng <a href="landau.html">chọn ngành và lớp</a> để bắt đầu học.</p>
                `;
                changeSelectionBtn.style.display = 'none'; // Ẩn nút nếu chưa có lựa chọn
                startLessonBtn.style.display = 'none'; // Ẩn nút bắt đầu bài học (nếu có)
            }

            // Nút "Đổi ngành/lớp" (trên info-bar)
            changeSelectionBtn.addEventListener('click', () => {
                window.location.href = 'landau.html'; // Chuyển về trang chọn ngành/lớp
            });

            // Nút "Đặt lại lựa chọn" (dưới cùng)
            resetSelectionBtn.addEventListener('click', () => {
                localStorage.removeItem('selectedPart');
                localStorage.removeItem('selectedClass');
                alert('Lựa chọn đã được đặt lại. Bạn sẽ được chuyển hướng đến trang chọn ngành/lớp.');
                window.location.href = 'landau.html'; // Chuyển về trang chọn ngành/lớp
            });

            // Nút startLessonBtn ở dưới cùng sẽ không còn được sử dụng
            // Đảm bảo nó bị ẩn đi
            if(startLessonBtn) {
                startLessonBtn.style.display = 'none';
            }
        });
    </script>
</body>
</html>